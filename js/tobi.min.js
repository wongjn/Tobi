!function(root,factory){"function"==typeof define&&define.amd?define(factory):"object"==typeof module&&module.exports?module.exports=factory():root.Tobi=factory()}(this,function(){"use strict";var Tobi;return function Tobi(userOptions){var config={},transformProperty=null,gallery=[],x=0,elements=null,elementsLength=null,sliderElements=[],currentIndex=0,drag={},pointerDown=!1,lastFocus=null,overlay=document.createElement("div");overlay.setAttribute("role","dialog"),overlay.setAttribute("aria-hidden","true"),overlay.classList.add("tobi-overlay"),document.getElementsByTagName("body")[0].appendChild(overlay);var slider=document.createElement("div");slider.classList.add("tobi-slider"),overlay.appendChild(slider);var prevButton=document.createElement("button");prevButton.setAttribute("type","button"),prevButton.setAttribute("aria-label","Previous"),overlay.appendChild(prevButton);var nextButton=document.createElement("button");nextButton.setAttribute("type","button"),nextButton.setAttribute("aria-label","Next"),overlay.appendChild(nextButton);var closeButton=document.createElement("button");closeButton.setAttribute("type","button"),closeButton.setAttribute("aria-label","Close"),overlay.appendChild(closeButton);var counter=document.createElement("div");counter.classList.add("tobi-counter"),overlay.appendChild(counter);var supportedElements={image:{checkSupport:function(element){return null!=element.href.match(/\.(png|jpg|tiff|tif|gif|bmp|webp|svg|ico)$/)},init:function(element,container){var image=document.createElement("img");if(image.style.opacity="0",element.getElementsByTagName("img")[0]&&element.getElementsByTagName("img")[0].alt?image.alt=element.getElementsByTagName("img")[0].alt:image.alt="",image.setAttribute("src",""),image.setAttribute("data-src",element.href),container.appendChild(image),container.setAttribute("data-type","image"),config.captions){var figcaption=document.createElement("figcaption");figcaption.style.opacity="0","self"===config.captionsSelector&&element.getAttribute(config.captionAttribute)?figcaption.innerHTML=element.getAttribute(config.captionAttribute):"img"===config.captionsSelector&&element.getElementsByTagName("img")[0]&&element.getElementsByTagName("img")[0].getAttribute(config.captionAttribute)&&(figcaption.innerHTML=element.getElementsByTagName("img")[0].getAttribute(config.captionAttribute)),figcaption.innerHTML&&(figcaption.id="tobi-figcaption-"+x,container.appendChild(figcaption),image.setAttribute("aria-labelledby",figcaption.id))}},onPreload:function(container){supportedElements.image.onLoad(container)},onLoad:function(container){var image=container.getElementsByTagName("img")[0];if(image.hasAttribute("data-src")){var figcaption=container.getElementsByTagName("figcaption")[0],loaderHtml=document.createElement("div");loaderHtml.classList.add("tobi-loader"),container.appendChild(loaderHtml),image.onload=function(){var loader=container.querySelector(".tobi-loader");container.removeChild(loader),image.style.opacity="1",figcaption&&(figcaption.style.opacity="1")},image.setAttribute("src",image.getAttribute("data-src")),image.removeAttribute("data-src")}},onLeave:function(container){}},youtube:{checkSupport:function(element){return!(!element.hasAttribute("data-type")||"youtube"!==element.getAttribute("data-type"))},init:function(element,container){var iframe=document.createElement("iframe"),href=element.href;-1===href.indexOf("?")&&(href+="?param=false"),href+="&enablejsapi=1";var wScreen=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,hScreen=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,w=1280;element.hasAttribute("data-width")&&(w=element.getAttribute("data-width")),w>wScreen&&(w=wScreen);var h=720;element.hasAttribute("data-height")&&(h=element.getAttribute("data-height")),h>hScreen&&(h=hScreen),iframe.setAttribute("width",w),iframe.setAttribute("height",h),iframe.setAttribute("frameborder","0"),iframe.setAttribute("allow","autoplay; encrypted-media"),iframe.setAttribute("allowfullscreen",""),iframe.style.opacity="0",iframe.setAttribute("src",""),iframe.setAttribute("data-src",href),container.appendChild(iframe),container.setAttribute("data-type","youtube")},onPreload:function(container){},onLoad:function(container){var iframe=container.getElementsByTagName("iframe")[0];iframe.style.opacity="1";var figcaption=container.getElementsByTagName("figcaption")[0];figcaption&&(figcaption.style.opacity="1"),iframe.setAttribute("src",iframe.getAttribute("data-src"))},onLeave:function(container){var video;container.getElementsByTagName("iframe")[0].setAttribute("src","")}},iframe:{checkSupport:function(element){return!(!element.hasAttribute("data-type")||"iframe"!==element.getAttribute("data-type"))},init:function(element,container){var iframe=document.createElement("iframe"),href=element.href,wScreen=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,hScreen=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,w=1280;element.hasAttribute("data-width")&&(w=element.getAttribute("data-width")),w>wScreen&&(w=wScreen);var h=720;element.hasAttribute("data-height")&&(h=element.getAttribute("data-height")),h>hScreen&&(h=hScreen),iframe.setAttribute("width",w),iframe.setAttribute("height",h),iframe.setAttribute("frameborder","0"),iframe.style.opacity="0",iframe.setAttribute("src",""),iframe.setAttribute("data-src",href),container.appendChild(iframe),container.setAttribute("data-type","iframe")},onPreload:function(container){},onLoad:function(container){var iframe=container.getElementsByTagName("iframe")[0];iframe.style.opacity="1";var figcaption=container.getElementsByTagName("figcaption")[0];figcaption&&(figcaption.style.opacity="1"),iframe.setAttribute("src",iframe.getAttribute("data-src"))},onLeave:function(container){var video;container.getElementsByTagName("iframe")[0].setAttribute("src","")}},html:{checkSupport:function(element){return!(!element.hasAttribute("data-type")||"html"!==element.getAttribute("data-type"))},init:function(element,container){var div=document.createElement("div");div.classList.add("tobi-html");var targetSelector=element.getAttribute("data-target"),target=document.querySelector(targetSelector);null!==target?(target.style.display="none",div.style.opacity="0",div.innerHTML=target.innerHTML,container.appendChild(div),container.setAttribute("data-type","html")):console.log("Ups, I can't find the target "+targetSelector+".")},onPreload:function(container){},onLoad:function(container){var div;container.querySelector(".tobi-html").style.opacity="1";var figcaption=container.getElementsByTagName("figcaption")[0];figcaption&&(figcaption.style.opacity="1")},onLeave:function(container){var video=container.querySelector("video");null!==video&&video.pause()}}},init=function init(userOptions){config=mergeOptions(userOptions),transformProperty=transformSupport(),elements=document.querySelectorAll(config.selector),(elementsLength=elements.length)?[].forEach.call(elements,function(element){initElement(element)}):console.log("Ups, I can't find the selector "+config.selector+".")},initElement=function initElement(element){if(-1===gallery.indexOf(element)){if(gallery.push(element),element.classList.add("tobi"),config.zoom&&element.getElementsByTagName("img")[0]){var tobiZoom=document.createElement("div");tobiZoom.classList.add("tobi__zoom-icon"),tobiZoom.innerHTML=config.zoomText,element.classList.add("tobi--zoom"),element.appendChild(tobiZoom)}element.addEventListener("click",function(event){event.preventDefault(),openOverlay(gallery.indexOf(this))}),createOverlay(element)}},createOverlay=function createOverlay(element){var sliderElement=null,figureWrapper=null,figure=null;for(var i in(sliderElement=document.createElement("div")).classList.add("tobi-slide"),(figureWrapper=document.createElement("div")).classList.add("tobi-figure-wrapper"),(figure=document.createElement("figure")).classList.add("tobi-figure"),supportedElements)if(!0===supportedElements[i].checkSupport(element)){supportedElements[i].init(element,figure);break}figureWrapper.appendChild(figure),sliderElement.appendChild(figureWrapper),slider.appendChild(sliderElement),sliderElements.push(sliderElement),++x,!config.nav||1===elementsLength||"auto"===config.nav&&"ontouchstart"in window?(prevButton.setAttribute("aria-hidden","true"),nextButton.setAttribute("aria-hidden","true")):(prevButton.setAttribute("aria-hidden","false"),nextButton.setAttribute("aria-hidden","false"),prevButton.innerHTML=config.navText[0],nextButton.innerHTML=config.navText[1]),config.counter&&1!==elementsLength?counter.setAttribute("aria-hidden","false"):counter.setAttribute("aria-hidden","true"),config.close?closeButton.innerHTML=config.closeText:closeButton.setAttribute("aria-hidden","true"),config.draggable&&(slider.style.cursor="-webkit-grab")},openOverlay=function openOverlay(index){"false"!==overlay.getAttribute("aria-hidden")&&(config.scroll||(document.documentElement.classList.add("tobi--is-open"),document.body.classList.add("tobi--is-open")),index||(index=0),lastFocus=document.activeElement,currentIndex=index,clearDrag(),bindEvents(),load(currentIndex),preload(currentIndex+1),preload(currentIndex-1),updateOffset(),updateCounter(),overlay.setAttribute("aria-hidden","false"),updateFocus())},closeOverlay=function closeOverlay(){"true"!==overlay.getAttribute("aria-hidden")&&(config.scroll||(document.documentElement.classList.remove("tobi--is-open"),document.body.classList.remove("tobi--is-open")),unbindEvents(),overlay.setAttribute("aria-hidden","true"),lastFocus.focus())},preload=function preload(index,callback,current){if(void 0!==sliderElements[index]){var container=sliderElements[index].querySelector("figure"),type=container.getAttribute("data-type");supportedElements[type].onPreload(container)}},load=function load(index,callback,current){if(void 0!==sliderElements[index]){var container=sliderElements[index].querySelector("figure"),type=container.getAttribute("data-type");supportedElements[type].onLoad(container)}},onElemenstLeave=function onElemenstLeave(){for(var index=0;index<sliderElements.length;index++){var container=sliderElements[index].querySelector("figure"),type=container.getAttribute("data-type");supportedElements[type].onLeave(container)}},mergeOptions=function mergeOptions(userOptions){var options={selector:".lightbox",captions:!0,captionsSelector:"img",captionAttribute:"alt",nav:"auto",navText:['<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6" /></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6" /></svg>'],close:!0,closeText:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></svg>',counter:!0,keyboard:!0,zoom:!0,zoomText:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></svg>',docClose:!0,swipeClose:!0,scroll:!1,draggable:!0,threshold:20};return userOptions&&Object.keys(userOptions).forEach(function(key){options[key]=userOptions[key]}),options},transformSupport=function transformSupport(){var div;return"string"==typeof document.documentElement.style.transform?"transform":"WebkitTransform"},updateOffset=function updateOffset(){var offset=100*-currentIndex+"%";slider.style[transformProperty]="translate3d("+offset+", 0, 0)"},updateCounter=function updateCounter(){counter.innerHTML=currentIndex+1+"/"+elementsLength},updateFocus=function updateFocus(direction){config.nav?(prevButton.disabled=!1,nextButton.disabled=!1,currentIndex===elementsLength-1?nextButton.disabled=!0:0===currentIndex&&(prevButton.disabled=!0),direction||nextButton.disabled?direction||!nextButton.disabled||prevButton.disabled?nextButton.disabled||"right"!==direction?nextButton.disabled&&"right"===direction&&!prevButton.disabled?prevButton.focus():prevButton.disabled||"left"!==direction?prevButton.disabled&&"left"===direction&&!nextButton.disabled&&nextButton.focus():prevButton.focus():nextButton.focus():prevButton.focus():nextButton.focus()):config.close&&closeButton.focus()},next=function next(){currentIndex!==sliderElements.length-1&&onElemenstLeave(),currentIndex<elementsLength-1&&(currentIndex++,updateOffset(),updateCounter(),updateFocus("right"),load(currentIndex),preload(currentIndex+1))},prev=function prev(){currentIndex>0&&onElemenstLeave(),currentIndex>0&&(currentIndex--,updateOffset(),updateCounter(),updateFocus("left"),load(currentIndex),preload(currentIndex-1))},clearDrag=function clearDrag(){drag={startX:0,endX:0,startY:0,endY:0}},updateAfterDrag=function updateAfterDrag(){var movementX=drag.endX-drag.startX,movementY=drag.endY-drag.startY,movementXDistance=Math.abs(movementX),movementYDistance=Math.abs(movementY);movementX>0&&movementXDistance>config.threshold?prev():movementX<0&&movementXDistance>config.threshold?next():movementY<0&&movementYDistance>config.threshold&&config.swipeClose&&closeOverlay()},clickHandler=function clickHandler(event){event.target===prevButton?prev():event.target===nextButton?next():(event.target===closeButton||event.target.classList.contains("tobi-figure-wrapper")&&!event.target.classList.contains("tobi-figure"))&&closeOverlay(),event.stopPropagation()},keydownHandler=function keydownHandler(event){switch(event.keyCode){case 37:prev();break;case 39:next();break;case 27:closeOverlay()}},touchstartHandler=function touchstartHandler(event){event.stopPropagation(),pointerDown=!0,drag.startX=event.touches[0].pageX,drag.startY=event.touches[0].pageY},touchmoveHandler=function touchmoveHandler(event){event.preventDefault(),event.stopPropagation(),pointerDown&&(drag.endX=event.touches[0].pageX,drag.endY=event.touches[0].pageY)},touchendHandler=function touchendHandler(event){event.stopPropagation(),pointerDown=!1,drag.endX&&updateAfterDrag(),clearDrag()},mousedownHandler=function mousedownHandler(event){event.preventDefault(),event.stopPropagation(),pointerDown=!0,drag.startX=event.pageX,slider.style.cursor="-webkit-grabbing"},mouseupHandler=function mouseupHandler(event){event.stopPropagation(),pointerDown=!1,slider.style.cursor="-webkit-grab",drag.endX&&updateAfterDrag(),clearDrag()},mousemoveHandler=function mousemoveHandler(event){event.preventDefault(),pointerDown&&(drag.endX=event.pageX,slider.style.cursor="-webkit-grabbing")},mouseleaveHandler=function mouseleaveHandler(event){pointerDown&&(pointerDown=!1,slider.style.cursor="-webkit-grab",drag.endX=event.pageX,updateAfterDrag(),clearDrag())},trapFocus=function trapFocus(event){"false"!==overlay.getAttribute("aria-hidden")||overlay.contains(event.target)||(event.stopPropagation(),updateFocus())},bindEvents=function bindEvents(){config.keyboard&&document.addEventListener("keydown",keydownHandler),config.docClose&&overlay.addEventListener("click",clickHandler),prevButton.addEventListener("click",clickHandler),nextButton.addEventListener("click",clickHandler),closeButton.addEventListener("click",clickHandler),config.draggable&&(overlay.addEventListener("touchstart",touchstartHandler),overlay.addEventListener("touchmove",touchmoveHandler),overlay.addEventListener("touchend",touchendHandler),overlay.addEventListener("mousedown",mousedownHandler),overlay.addEventListener("mouseup",mouseupHandler),overlay.addEventListener("mouseleave",mouseleaveHandler),overlay.addEventListener("mousemove",mousemoveHandler)),document.addEventListener("focus",trapFocus,!0)},unbindEvents=function unbindEvents(){config.keyboard&&document.removeEventListener("keydown",keydownHandler),config.docClose&&overlay.removeEventListener("click",clickHandler),prevButton.removeEventListener("click",clickHandler),nextButton.removeEventListener("click",clickHandler),closeButton.removeEventListener("click",clickHandler),config.draggable&&(overlay.removeEventListener("touchstart",touchstartHandler),overlay.removeEventListener("touchmove",touchmoveHandler),overlay.removeEventListener("touchend",touchendHandler),overlay.removeEventListener("mousedown",mousedownHandler),overlay.removeEventListener("mouseup",mouseupHandler),overlay.removeEventListener("mouseleave",mouseleaveHandler),overlay.removeEventListener("mousemove",mousemoveHandler)),document.removeEventListener("focus",trapFocus),onElemenstLeave()},add=function add(element){initElement(element),elementsLength++};return init(userOptions),{prev:prev,next:next,open:openOverlay,close:closeOverlay,add:add}}});